<script setup lang="ts">
import { WxMessage } from "@/typings/wx";
import { ImageEvent, ImageProps } from "tdesign-vue-next";
import { ref } from "vue";
let props = defineProps<{
  message: WxMessage | undefined;
  avatar: string | undefined;
}>();

// 这里是准备写消息的收发的框框，宽度有最大值，高度也有最大值，两边有箭头，同时，发送和接收是两种背景色，发送最好加一下loading效果
// 这里还有时间的显示的问题，看起来是一段时间显示一次，而不是每次都显示，这个应该是考虑在聊天记录的上下文中自动插入的，也是作为一个消息吗？
// 消息的设计，这里需要明确消息的类型，暂时就只处理：文本，图片，语音，视频，引用，卡片的话以后再说
// 一条消息肯定要先能判断是什么消息，来自于谁，是自己还是别人，然后找到那个人，进行信息的加载
// 通讯录应该要缓存一份，这样在加载的时候，就可以批量去读取，而不是说动态的去查询，否则两边压力都很大
let imageUrl = props.message && props.message.images ? props.message.images[0] || "" : ""
/* props.message && props.message.images
    ? "http://192.168.2.12:10010/download?file_path=" + props.message.images[0]
    : ""; */
let imageWidth = ref("unset");
let imageHeight = ref("unset");
let success = ref(true)
function imageOnload(context: { e: ImageEvent }) {
  const { width, height } = context.e.target as HTMLImageElement;
  let ratio = 1;
  let ratioWidth = 250 / width;
  let ratioHeight = 250 / height;
  ratio = Math.min(ratioWidth, ratioHeight);
  if (ratio > 1) {
    ratio = 1;
  }
  if (ratioHeight < ratioWidth) {
    imageHeight.value = height * ratio + "px";
  } else {
    imageWidth.value = width * ratio + "px";
  }
}

function imageOnError() {
  success.value = false
}
</script>
<template>
  <div class="msg-box-content-image">
    <t-image v-if="success" v-show="imageWidth !== 'unset' || imageHeight !== 'unset'" :src="imageUrl"
      :style="{ width: imageWidth, height: imageHeight }" fit="fill" shape="round" :on-load="imageOnload"
      :on-error="imageOnError">
      <template #overlayContent>
        <div shape="mark" theme="primary" variant="light" style="width: 100%;height: 100%;text-align: center; padding-top: 55%;">
          <!-- 先用这个把，素材后期统一替换 -->
          <font-awesome-icon icon="fa-regular fa-circle-play" style="font-size: 40px;"/>
        </div>
      </template>
    </t-image>
    <t-image style="background-color: unset;" v-else fit="fill" shape="round"
      src="data:image/png;base64,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" />
  </div>
</template>